
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A comprehensive framework for causal inference testing with multiple estimators">
      
      
      
        <link rel="canonical" href="https://example.com/CausalPilot/estimator_theory/">
      
      
        <link rel="prev" href="../causal_inference_intro/">
      
      
        <link rel="next" href="../api_documentation/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Theory - CausalPilot</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#theory-behind-causal-inference-estimators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CausalPilot" class="md-header__button md-logo" aria-label="CausalPilot" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CausalPilot
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Theory
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../causal_inference_intro/" class="md-tabs__link">
        
  
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Theory

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../api_documentation/" class="md-tabs__link">
        
  
  
    
  
  API Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CausalPilot" class="md-nav__button md-logo" aria-label="CausalPilot" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CausalPilot
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../causal_inference_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Theory
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Theory
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-doubledebiased-machine-learning-doubleml" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Double/Debiased Machine Learning (DoubleML)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Double/Debiased Machine Learning (DoubleML)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#theoretical-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Theoretical Foundation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mathematical-framework" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mathematical Framework
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-theoretical-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Theoretical Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Theoretical Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-neyman-orthogonality" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Neyman Orthogonality
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-cross-fitting-procedure" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Cross-Fitting Procedure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-moment-condition" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Moment Condition
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#theoretical-guarantees" class="md-nav__link">
    <span class="md-ellipsis">
      
        Theoretical Guarantees
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-causal-forest" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Causal Forest
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Causal Forest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#theoretical-foundation_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Theoretical Foundation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mathematical-framework_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mathematical Framework
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algorithm-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Algorithm Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Algorithm Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-honest-tree-construction" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Honest Tree Construction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-splitting-criterion" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Splitting Criterion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-treatment-effect-estimation" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Treatment Effect Estimation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-forest-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Forest Aggregation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-meta-learners-t-learner-s-learner-x-learner" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Meta-Learners (T-learner, S-learner, X-learner)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Meta-Learners (T-learner, S-learner, X-learner)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#theoretical-framework" class="md-nav__link">
    <span class="md-ellipsis">
      
        Theoretical Framework
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-learner-two-model-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-learner (Two-Model Approach)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="T-learner (Two-Model Approach)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Algorithm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advantages-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advantages and Limitations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#s-learner-single-model-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        S-learner (Single-Model Approach)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="S-learner (Single-Model Approach)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#algorithm_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Algorithm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advantages-and-limitations_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advantages and Limitations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#x-learner-cross-learner" class="md-nav__link">
    <span class="md-ellipsis">
      
        X-learner (Cross-learner)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="X-learner (Cross-learner)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#algorithm_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Algorithm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#theoretical-advantages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Theoretical Advantages
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-instrumental-variables-iv2sls" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Instrumental Variables (IV2SLS)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Instrumental Variables (IV2SLS)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#theoretical-foundation_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Theoretical Foundation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mathematical-framework_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mathematical Framework
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algorithm_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Algorithm
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-comparison-of-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Comparison of Methods
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="theory-behind-causal-inference-estimators">Theory Behind Causal Inference Estimators</h1>
<h2 id="introduction">Introduction</h2>
<p>This document provides a comprehensive theoretical foundation for the causal inference estimators I have implemented in CausalPilot. Each method addresses specific challenges in causal inference while making different assumptions about the data-generating process and treatment effect heterogeneity.</p>
<h2 id="1-doubledebiased-machine-learning-doubleml">1. Double/Debiased Machine Learning (DoubleML)</h2>
<h3 id="theoretical-foundation">Theoretical Foundation</h3>
<p>Double Machine Learning addresses the challenge of estimating causal effects in high-dimensional settings where traditional parametric methods may be biased or inefficient. I chose to implement this because it allows for the use of powerful machine learning models (like Random Forests or Gradient Boosting) to control for confounders without introducing regularization bias into the causal estimate.</p>
<h3 id="mathematical-framework">Mathematical Framework</h3>
<p>Consider the partially linear regression model:
$$ Y = \theta T + g(X) + U $$
$$ T = m(X) + V $$</p>
<p>Where:
- $Y$ is the outcome variable
- $T$ is the treatment variable<br />
- $X$ are confounding covariates
- $\theta$ is the causal parameter of interest
- $g(X) = E[Y|X]$ is the conditional expectation function
- $m(X) = E[T|X]$ is the propensity score
- $U, V$ are error terms with $E[U|X] = E[V|X] = 0$</p>
<h3 id="key-theoretical-components">Key Theoretical Components</h3>
<h4 id="1-neyman-orthogonality">1. Neyman Orthogonality</h4>
<p>The estimating equation satisfies:
$$ E[\psi(W; \theta, \eta)] = 0 $$
where $\psi$ is approximately insensitive to perturbations in nuisance parameters $\eta = (g, m)$. This ensures that small errors in nuisance function estimation don't dramatically affect the causal parameter estimate.</p>
<h4 id="2-cross-fitting-procedure">2. Cross-Fitting Procedure</h4>
<p>I implemented cross-fitting to avoid overfitting:
1. <strong>Sample Splitting</strong>: Randomly partition data into $K$ folds
2. <strong>Nuisance Estimation</strong>: For each fold $k$:
   - Train models $\hat{g}<em>{-k}$ and $\hat{m}</em>{-k}$ on data excluding fold $k$
   - Predict on fold $k$ to get $\hat{g}<em>{-k}(X_i)$ and $\hat{m}</em>{-k}(X_i)$ for $i \in k$
3. <strong>Parameter Estimation</strong>: Solve the moment condition using all folds</p>
<h4 id="3-moment-condition">3. Moment Condition</h4>
<p>The orthogonal moment condition for the partially linear model is:
$$ \psi(W_i; \theta, \eta) = (T_i - m(X_i))(Y_i - \theta T_i - g(X_i)) $$</p>
<h3 id="theoretical-guarantees">Theoretical Guarantees</h3>
<p>Under regularity conditions, the DoubleML estimator is:
- <strong>$\sqrt{n}$-consistent</strong>: Converges at the parametric rate
- <strong>Asymptotically normal</strong>: Normal limiting distribution enables confidence intervals
- <strong>Semiparametrically efficient</strong>: Achieves the efficiency bound</p>
<h2 id="2-causal-forest">2. Causal Forest</h2>
<h3 id="theoretical-foundation_1">Theoretical Foundation</h3>
<p>Causal Forests extend random forests to estimate heterogeneous treatment effects by building trees that explicitly optimize for treatment effect heterogeneity rather than prediction accuracy. I included this estimator to allow users to understand <em>who</em> benefits most from a treatment.</p>
<h3 id="mathematical-framework_1">Mathematical Framework</h3>
<p>The goal is to estimate the Conditional Average Treatment Effect (CATE):
$$ \tau(x) = E[Y(1) - Y(0)|X = x] $$</p>
<p>Where $Y(1)$ and $Y(0)$ are potential outcomes under treatment and control.</p>
<h3 id="algorithm-structure">Algorithm Structure</h3>
<h4 id="1-honest-tree-construction">1. Honest Tree Construction</h4>
<p>Each tree is built using sample splitting:
- <strong>I</strong>: Subsample for determining splits
- <strong>J</strong>: Disjoint subsample for estimating treatment effects</p>
<p>This "honesty" prevents overfitting and ensures valid statistical inference.</p>
<h4 id="2-splitting-criterion">2. Splitting Criterion</h4>
<p>Instead of optimizing prediction accuracy, causal trees maximize treatment effect heterogeneity. For a potential split of parent node $P$ into children $C_1$ and $C_2$:</p>
<p>$$ \text{Split criterion} = \frac{n_1 n_2}{n_1 + n_2} \times (\hat{\tau}(C_1) - \hat{\tau}(C_2))^2 $$</p>
<p>Where $\hat{\tau}(C_k)$ is the estimated treatment effect in child $k$.</p>
<h4 id="3-treatment-effect-estimation">3. Treatment Effect Estimation</h4>
<p>In each leaf, the treatment effect is estimated using:
$$ \hat{\tau}<em>{leaf} = \frac{\sum</em>{i \in leaf} T_i Y_i}{\sum_{i \in leaf} T_i} - \frac{\sum_{i \in leaf} (1-T_i) Y_i}{\sum_{i \in leaf} (1-T_i)} $$</p>
<h4 id="4-forest-aggregation">4. Forest Aggregation</h4>
<p>The final estimate is a weighted average:
$$ \hat{\tau}(x) = \sum_{i=1}^n \alpha_i(x) Y_i $$</p>
<p>Where $\alpha_i(x)$ represents the weight given to observation $i$ when predicting at point $x$, determined by how often $i$ and $x$ fall in the same leaf across trees.</p>
<h2 id="3-meta-learners-t-learner-s-learner-x-learner">3. Meta-Learners (T-learner, S-learner, X-learner)</h2>
<h3 id="theoretical-framework">Theoretical Framework</h3>
<p>Meta-learners are flexible approaches that use any supervised learning algorithm as a "base learner" to estimate treatment effects.</p>
<h3 id="t-learner-two-model-approach">T-learner (Two-Model Approach)</h3>
<h4 id="algorithm">Algorithm</h4>
<ol>
<li><strong>Separate Models</strong>: Train two models:</li>
<li>$\mu_0(x) = E[Y|X = x, T = 0]$ (control model)</li>
<li>
<p>$\mu_1(x) = E[Y|X = x, T = 1]$ (treatment model)</p>
</li>
<li>
<p><strong>Effect Estimation</strong>: 
   $$ \hat{\tau}(x) = \hat{\mu}_1(x) - \hat{\mu}_0(x) $$</p>
</li>
</ol>
<h4 id="advantages-and-limitations">Advantages and Limitations</h4>
<p><strong>Advantages:</strong>
- Simple and intuitive
- Flexible choice of base learner</p>
<p><strong>Limitations:</strong>
- Requires sufficient data in both treatment groups
- No regularization across treatment groups</p>
<h3 id="s-learner-single-model-approach">S-learner (Single-Model Approach)</h3>
<h4 id="algorithm_1">Algorithm</h4>
<ol>
<li>
<p><strong>Combined Model</strong>: Train single model:
   $$ \mu(x,t) = E[Y|X = x, T = t] $$</p>
</li>
<li>
<p><strong>Effect Estimation</strong>:
   $$ \hat{\tau}(x) = \hat{\mu}(x,1) - \hat{\mu}(x,0) $$</p>
</li>
</ol>
<h4 id="advantages-and-limitations_1">Advantages and Limitations</h4>
<p><strong>Advantages:</strong>
- Uses all data for model training
- Good when treatment effects are small</p>
<p><strong>Limitations:</strong>
- May miss treatment effect heterogeneity if base learner doesn't capture interactions well</p>
<h3 id="x-learner-cross-learner">X-learner (Cross-learner)</h3>
<p>I implemented the X-Learner specifically for cases where one treatment group is much larger than the other (e.g., a small treatment group and a large control group).</p>
<h4 id="algorithm_2">Algorithm</h4>
<ol>
<li><strong>Stage 1</strong>: Train separate outcome models (like T-learner)</li>
<li><strong>Stage 2</strong>: Estimate individual treatment effects:</li>
<li>For treated units: $\hat{\tau}_{1i} = Y_i - \hat{\mu}_0(X_i)$</li>
<li>For control units: $\hat{\tau}_{0i} = \hat{\mu}_1(X_i) - Y_i$</li>
<li><strong>Stage 3</strong>: Train models to predict these effects:</li>
<li>$\hat{\tau}_1(x) = E[\hat{\tau}_1|X = x, T = 1]$  </li>
<li>$\hat{\tau}_0(x) = E[\hat{\tau}_0|X = x, T = 0]$</li>
<li><strong>Final Estimate</strong>: Weighted combination using propensity scores</li>
</ol>
<h4 id="theoretical-advantages">Theoretical Advantages</h4>
<ul>
<li><strong>Doubly Robust</strong>: Good performance if either outcome models or propensity model is correct</li>
<li><strong>Efficiency</strong>: Often more efficient than T-learner or S-learner</li>
</ul>
<h2 id="4-instrumental-variables-iv2sls">4. Instrumental Variables (IV2SLS)</h2>
<h3 id="theoretical-foundation_2">Theoretical Foundation</h3>
<p>Sometimes, we have <strong>unobserved confounders</strong> ($U$) that affect both $T$ and $Y$. In this case, adjusting for $X$ is not enough. I implemented <strong>Two-Stage Least Squares (IV2SLS)</strong> to handle this scenario.</p>
<h3 id="mathematical-framework_2">Mathematical Framework</h3>
<p>We assume the following structural equations:
$$ Y = \beta T + \gamma X + U $$
$$ T = \delta Z + \phi X + V $$</p>
<p>Where $Z$ is an <strong>Instrument</strong> that satisfies:
1. <strong>Relevance</strong>: $Z$ affects $T$ ($\delta \neq 0$).
2. <strong>Exclusion</strong>: $Z$ affects $Y$ <em>only</em> through $T$ (no direct path $Z \to Y$).
3. <strong>Independence</strong>: $Z$ is independent of $U$.</p>
<h3 id="algorithm_3">Algorithm</h3>
<ol>
<li><strong>First Stage</strong>: Regress $T$ on $Z$ and $X$ to get $\hat{T}$.
   $$ \hat{T} = \hat{\delta} Z + \hat{\phi} X $$</li>
<li><strong>Second Stage</strong>: Regress $Y$ on $\hat{T}$ and $X$.
   $$ Y = \beta_{IV} \hat{T} + \gamma_{IV} X + \epsilon $$</li>
</ol>
<p>This isolates the variation in $T$ that is caused by $Z$ (which is clean) and ignores the variation caused by $U$ (which is confounded).</p>
<h2 id="5-comparison-of-methods">5. Comparison of Methods</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Best Use Case</th>
<th>Key Assumption</th>
<th>Computational Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>DoubleML</td>
<td>High-dimensional confounders</td>
<td>Unconfoundedness</td>
<td>Medium</td>
</tr>
<tr>
<td>Causal Forest</td>
<td>Effect heterogeneity discovery</td>
<td>Unconfoundedness</td>
<td>High</td>
</tr>
<tr>
<td>T-learner</td>
<td>Clear treatment groups</td>
<td>Sufficient sample in each group</td>
<td>Low</td>
</tr>
<tr>
<td>S-learner</td>
<td>Small treatment effects</td>
<td>Treatment-outcome relationship captured</td>
<td>Low</td>
</tr>
<tr>
<td>X-learner</td>
<td>Imbalanced treatment groups</td>
<td>Either outcomes or propensity correct</td>
<td>Medium</td>
</tr>
<tr>
<td>IV2SLS</td>
<td>Unobserved confounding</td>
<td>Valid Instrument</td>
<td>Low</td>
</tr>
</tbody>
</table>
<h2 id="conclusion">Conclusion</h2>
<p>Each estimator offers different strengths for various causal inference scenarios. DoubleML excels with high-dimensional data, Causal Forests discover complex heterogeneity patterns, and meta-learners provide flexible, interpretable approaches. The choice depends on the specific research question, data characteristics, and computational constraints.</p>
<h2 id="references">References</h2>
<ul>
<li>Chernozhukov et al. (2018). "Double/debiased machine learning for treatment and structural parameters."</li>
<li>Wager, S., &amp; Athey, S. (2018). "Estimation and inference of heterogeneous treatment effects using random forests."</li>
<li>KÃ¼nzel, S. R., et al. (2019). "Metalearners for estimating heterogeneous treatment effects using machine learning."</li>
<li>Angrist, J. D., &amp; Pischke, J. S. (2009). "Mostly harmless econometrics: An empiricist's companion."</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>